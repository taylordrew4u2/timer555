<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>THE OPEN MICER TIMER</title>
    <!-- Swis721 BlkEx BT font via CDN (if available), fallback to Arial Black/Impact -->
    <link rel="preconnect" href="https://fonts.cdnfonts.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.cdnfonts.com/css/swis721-blkex-bt" />
    <style>
         :root {
            --bg: #000;
            --fg: #fff;
            --accent: #ff2b2b;
        }
        
        * {
            box-sizing: border-box;
        }
        
        html,
        body {
            height: 100%;
        }
        
        body {
            margin: 0;
            background: var(--bg);
            color: #fff;
            display: flex;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            font-family: Arial, sans-serif;
        }
        
        .wrap {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }
        
        .marquee-outer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            overflow: hidden;
            height: 32px;
            padding: 0;
            background: #000;
            z-index: 1000;
        }
        
        @keyframes scroll-left {
            0% {
                transform: translateX(100vw);
            }
            100% {
                transform: translateX(-100vw);
            }
        }
        
        .timer-area {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0;
            position: relative;
            height: 100%;
            overflow: auto;
        }
        
        #timer {
            font-family: Arial, sans-serif;
            font-variant-numeric: tabular-nums;
            font-size: clamp(24vw, 54vmin, 72vw);
            font-weight: 900;
            line-height: 1.05;
            letter-spacing: 1.8vmin;
            text-align: center;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            color: #fff;
            background: transparent;
            /* border-radius removed */
            padding: 0.08em 0.5em 0.12em 0.5em;
            box-shadow: none;
            width: 100%;
            max-width: 96vw;
            max-height: 60vh;
            height: 100%;
            box-sizing: border-box;
            display: inline-block;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow: hidden;
        }
        
        #timer.red {
            color: #ff2b2b;
            text-shadow: none;
            background: transparent;
            box-shadow: none;
        }
        
        .controls {
            display: flex;
            flex-direction: row;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 0;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            max-width: 100vw;
            z-index: 1001;
            background: transparent;
        }
        
        .btn {
            flex: 0 1 auto;
            background: none;
            color: #fff;
            border: 2px solid #fff;
            border-radius: 6px;
            padding: 0.2em 0.8em;
            box-sizing: border-box;
            font-size: clamp(12px, 2.2vmin, 16px);
            font-weight: 700;
            text-transform: none;
            letter-spacing: .2px;
            outline: none;
            cursor: pointer;
            touch-action: manipulation;
            min-width: 48px;
            min-height: 32px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn:focus-visible {
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.25);
        }
        
        #flash {
            position: fixed;
            inset: 0;
            pointer-events: none;
            background: rgba(255, 0, 0, 0);
            display: none;
            z-index: 5;
            animation: flashRed 0.8s ease-in-out infinite alternate;
        }
        
        body.flash #flash {
            display: block;
        }
        
        @keyframes flashRed {
            from {
                background: rgba(255, 0, 0, 0.12);
            }
            to {
                background: rgba(255, 0, 0, 0.45);
            }
        }
        
        #solid {
            position: fixed;
            inset: 0;
            background: var(--accent);
            display: none;
            z-index: 10;
        }
        
        body.solid #solid {
            display: block;
        }
        
        #toast {
            position: fixed;
            left: 50%;
            bottom: calc(70px + env(safe-area-inset-bottom));
            transform: translateX(-50%);
            background: rgba(0, 0, 0, .7);
            color: #fff;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 14px;
            display: none;
            z-index: 20;
            max-width: 90vw;
            text-align: center;
        }
        
        #toast.show {
            display: block;
        }
        
        html,
        body {
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
            touch-action: manipulation;
        }
    </style>
</head>

<body>
    <div id="flash" aria-hidden="true"></div>
    <div id="solid" aria-hidden="true"></div>
    <div id="toast" role="status" aria-live="polite">Browsers don’t allow pages to exit themselves.</div>

    <div class="wrap">
        <main class="timer-area">
            <div id="timer" aria-label="Countdown Timer">5:00</div>
            <div class="controls">
                <button class="btn" id="downBtn" title="Down 10s (↓ or -)" aria-label="Down 10 seconds" role="button" tabindex="0">▼ −10s</button>
                <button class="btn" id="startBtn" title="Start / Pause (Space)" aria-label="Start or Pause Timer" role="button" tabindex="0">Start</button>
                <button class="btn" id="resetBtn" title="Reset Timer (R)" aria-label="Reset Timer" role="button" tabindex="0">Reset</button>

                <button class="btn" id="upBtn" title="Up 10s (↑ or +)" aria-label="Up 10 seconds" role="button" tabindex="0">▲ +10s</button>
            </div>
        </main>
    </div>
    <script>
        (() => {



            const timerEl = document.getElementById('timer');
            const upBtn = document.getElementById('upBtn');
            const downBtn = document.getElementById('downBtn');
            const resetBtn = document.getElementById('resetBtn');
            const startBtn = document.getElementById('startBtn');
            const toastEl = document.getElementById('toast');

            const SOLID_MS = 5000;
            let baseSeconds = 300; // default 5 minutes
            let isRunning = false;
            let deadline = null; // timestamp (ms) when countdown hits 0
            let pausedRemaining = baseSeconds;
            let solidUntil = 0; // timestamp (ms) until which solid red is shown
            let rafId = 0;

            function start() {
                if (document.body.classList.contains('solid')) return; // ignore during solid screen
                if (!isRunning) {
                    const startFrom = remainingSeconds();
                    deadline = now() + startFrom * 1000;
                    isRunning = true;
                    startBtn.textContent = 'Pause';
                }
            }

            function pause() {
                if (isRunning) {
                    pausedRemaining = remainingSeconds();
                    isRunning = false;
                    deadline = null;
                    startBtn.textContent = 'Start';
                }
            }

            function toggleStart() {
                if (isRunning) pause();
                else start();
            }

            addButtonHandler(startBtn, toggleStart);

            function format(seconds) {
                seconds = Math.max(0, Math.floor(seconds));
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${String(s).padStart(2, '0')}`;
            }

            function now() {
                return Date.now();
            }

            function remainingSeconds() {
                if (document.body.classList.contains('solid')) return 0;
                if (isRunning && deadline) {
                    return Math.ceil((deadline - now()) / 1000);
                } else {
                    return pausedRemaining;
                }
            }

            function setRemaining(newSeconds) {
                newSeconds = Math.max(0, Math.min(36000, newSeconds)); // clamp 0..10h
                if (isRunning && deadline) {
                    deadline = now() + newSeconds * 1000;
                } else {
                    pausedRemaining = newSeconds;
                }
                updateImmediate();
            }

            function resetTimer() {
                isRunning = false;
                deadline = null;
                pausedRemaining = baseSeconds;
                updateImmediate();
            }

            function showToast(msg, ms = 1800) {
                toastEl.textContent = msg;
                toastEl.classList.add('show');
                setTimeout(() => toastEl.classList.remove('show'), ms);
            }



            function enterSolid() {
                document.body.classList.remove('flash');
                document.body.classList.add('solid');
                isRunning = false;
                deadline = null;
                solidUntil = Date.now() + SOLID_MS;
            }

            function maybeLeaveSolid() {
                if (document.body.classList.contains('solid') && Date.now() >= solidUntil) {
                    document.body.classList.remove('solid');
                    pausedRemaining = baseSeconds;
                    isRunning = true;
                    deadline = Date.now() + pausedRemaining * 1000;
                }
            }

            function updateImmediate() {
                const rem = remainingSeconds();
                timerEl.textContent = format(rem);
                if (rem <= 60 && !document.body.classList.contains('solid')) {
                    timerEl.classList.add('red');
                    document.body.classList.add('flash');
                } else {
                    timerEl.classList.remove('red');
                    document.body.classList.remove('flash');
                }
            }

            function tick() {
                rafId = requestAnimationFrame(tick);
                if (document.body.classList.contains('solid')) {
                    maybeLeaveSolid();
                    return;
                }
                if (isRunning) {
                    const rem = remainingSeconds();
                    if (rem <= 0) {
                        timerEl.textContent = "0:00";
                        enterSolid();
                        return;
                    }
                }
                updateImmediate();
            }

            function addButtonHandler(btn, handler) {
                let touchHandled = false;
                btn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    touchHandled = true;
                    handler();
                    setTimeout(() => {
                        touchHandled = false;
                    }, 350);
                }, {
                    passive: false
                });
                btn.addEventListener('click', function(e) {
                    if (touchHandled) return;
                    handler();
                });
            }

            addButtonHandler(upBtn, () => setRemaining(remainingSeconds() + 10));
            addButtonHandler(downBtn, () => setRemaining(remainingSeconds() - 10));

            addButtonHandler(resetBtn, resetTimer);

            // Keyboard shortcuts for better usability
            document.addEventListener('keydown', function(e) {
                // Only handle keys when not typing in an input field
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                switch(e.code) {
                    case 'Space':
                        e.preventDefault();
                        startBtn.click();
                        break;
                    case 'KeyR':
                        e.preventDefault();
                        resetBtn.click();
                        break;
                    case 'ArrowUp':
                    case 'Equal': // + key
                    case 'NumpadAdd':
                        e.preventDefault();
                        upBtn.click();
                        break;
                    case 'ArrowDown':
                    case 'Minus': // - key
                    case 'NumpadSubtract':
                        e.preventDefault();
                        downBtn.click();
                        break;
                }
            });

            document.addEventListener('visibilitychange', () => {
                updateImmediate();
            });
            window.addEventListener('focus', updateImmediate);
            window.addEventListener('resize', updateImmediate);
            window.addEventListener('orientationchange', updateImmediate);

            updateImmediate();
            cancelAnimationFrame(rafId);
            tick();
        })();
    </script>
</body>

</html>